<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Carta Navide√±a üéÑ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <style>
      * {
        box-sizing: border-box;
      }

      /* ====== FONDO NAVIDE√ëO (solo CSS) ======
         - degradados profundos para el cielo
         - pseudo-elementos para luces tipo "bokeh" y estrellas/destellos
         - animaci√≥n muy sutil para parpadeo de estrellas (desactivada si se prefiere menos movimiento)
      */
      html,
      body {
        height: 100%;
      }

      body {
        margin: 0;
        height: 100vh;
        font-family: Georgia, serif;
        /* 1) base de color con degradado vertical */
        background-color: #02121a;
        background-image:
          radial-gradient(circle at 15% 10%, rgba(255,255,255,0.04) 0%, rgba(255,255,255,0) 12%),
          radial-gradient(circle at 85% 25%, rgba(255,255,255,0.03) 0%, rgba(255,255,255,0) 10%),
          linear-gradient(180deg, #063244 0%, #022f3a 40%, #00121a 100%);
        background-repeat: no-repeat;
        background-size: cover;
        overflow: hidden;
        display: flex;
        justify-content: center;
        align-items: center;
        color: white;
      }

      /* Luces tipo "bokeh" suaves (delante del fondo, detr√°s del contenido) */
      body::before {
        content: "";
        position: fixed;
        inset: 0;
        pointer-events: none;
        z-index: -2;
        background-image:
          radial-gradient(circle at 10% 20%, rgba(226,103,110,0.10) 0 8%, transparent 18%),
          radial-gradient(circle at 30% 40%, rgba(241,199,88,0.08) 0 7%, transparent 15%),
          radial-gradient(circle at 75% 25%, rgba(81,209,180,0.08) 0 6%, transparent 14%);
        mix-blend-mode: screen;
        filter: blur(8px) saturate(110%);
      }

      /* Estrellas / destellos sutiles (puntos blancos peque√±os) */
      body::after {
        content: "";
        position: fixed;
        inset: 0;
        pointer-events: none;
        z-index: -1;
        background-image:
          radial-gradient(circle at 4% 10%, rgba(255,255,255,0.9) 0.8px, transparent 1px),
          radial-gradient(circle at 18% 25%, rgba(255,255,255,0.85) 0.7px, transparent 1px),
          radial-gradient(circle at 30% 8%, rgba(255,255,255,0.7) 0.9px, transparent 1px),
          radial-gradient(circle at 52% 18%, rgba(255,255,255,0.6) 0.6px, transparent 1px),
          radial-gradient(circle at 70% 35%, rgba(255,255,255,0.9) 0.8px, transparent 1px),
          radial-gradient(circle at 88% 12%, rgba(255,255,255,0.75) 0.7px, transparent 1px),
          radial-gradient(circle at 60% 5%, rgba(255,255,255,0.65) 0.8px, transparent 1px);
        background-size: 100% 100%;
        opacity: 0.9;
        animation: twinkle 4s linear infinite;
        mix-blend-mode: screen;
      }

      @keyframes twinkle {
        0% {
          opacity: 0.85;
          transform: translateZ(0);
        }
        50% {
          opacity: 1;
        }
        100% {
          opacity: 0.85;
        }
      }

      /* ====== PANTALLA INICIAL ====== */
      .start {
        position: absolute;
        inset: 0;
        background: rgba(0, 0, 0, 0.65);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
        z-index: 10;
        padding: 20px;
        transition: opacity 1s ease;
      }

      .start h1 {
        font-size: 1.9rem;
        margin-bottom: 25px;
        animation: pulse 1.8s infinite;
      }

      @keyframes pulse {
        50% {
          transform: scale(1.05);
        }
      }

      .open-btn {
        padding: 15px 28px;
        font-size: 1.1rem;
        border-radius: 35px;
        border: none;
        background: linear-gradient(135deg, #e63946, #2a9d8f);
        color: white;
        box-shadow: 0 0 10px rgba(255, 255, 255, 0.35);
        cursor: pointer;
      }

      .open-btn:focus {
        outline: 3px solid rgba(255, 255, 255, 0.45);
        outline-offset: 4px;
      }

      .countdown {
        margin-top: 25px;
        font-size: 2.5rem;
        display: none;
      }

      /* ====== CARTA ====== */
      .card {
        display: none;
        background: rgba(0, 0, 0, 0.6);
        width: 92%;
        max-width: 380px;
        padding: 24px;
        border-radius: 20px;
        text-align: center;
        box-shadow: 0 0 14px rgba(255, 255, 255, 0.3);
      }

      .intro {
        font-size: 1.8rem;
        font-weight: bold;
        letter-spacing: 1px;
        margin-bottom: 10px;
      }

      #text {
        font-size: 1rem;
        line-height: 1.7;
        white-space: pre-line;
      }

      .firma {
        opacity: 0;
        margin-top: 18px;
        color: #a8dadc;
        transition: opacity 1.8s ease;
      }

      .firma.show {
        opacity: 1;
      }

      .versiculo {
        margin-top: 18px;
        font-size: 0.9rem;
        font-style: italic;
        line-height: 1.6;
        min-height: 55px;
      }

      /* ====== NIEVE ====== */
      .snow {
        position: absolute;
        top: -10px;
        font-size: 20px;
        animation: fall linear forwards;
        pointer-events: none;
      }

      @keyframes fall {
        to {
          transform: translateY(110vh);
        }
      }

      /* ====== CONFETI ====== */
      .confetti {
        position: absolute;
        width: 6px;
        height: 12px;
        top: -10px;
        animation: confetti-fall linear forwards;
        pointer-events: none;
      }

      @keyframes confetti-fall {
        to {
          transform: translateY(110vh) rotate(540deg);
          opacity: 0;
        }
      }

      /* ====== MEJORAS PC ====== */
      @media (min-width: 768px) {
        .start h1 {
          font-size: 2.2rem;
        }

        .card {
          animation: glow 2s infinite alternate;
        }

        @keyframes glow {
          from {
            box-shadow: 0 0 12px red;
          }
          to {
            box-shadow: 0 0 26px green;
          }
        }
      }

      /* Respeta usuarios que prefieren menos movimiento */
      @media (prefers-reduced-motion: reduce) {
        .start h1,
        .card {
          animation: none !important;
        }
        .snow,
        .confetti {
          display: none !important;
        }
        /* eliminar animaciones de fondo */
        body::after,
        body::before {
          animation: none !important;
          opacity: 1 !important;
          filter: none !important;
        }
      }
    </style>
  </head>

  <body>
    <!-- Audios -->
    <audio id="bell" preload="auto" playsinline>
      <source src="./sinos-de-natal-440257.mp3" />
    </audio>

    <audio id="music" loop preload="auto" playsinline>
      <source src="./we-wish-you-a-merry-christmas-444573.mp3" />
    </audio>

    <!-- Inicio -->
    <div class="start" id="start" aria-hidden="false">
      <h1>üéÑ Tengo algo para ti üéÑ</h1>
      <button class="open-btn" id="openBtn" type="button">
        üéÅ Abrir carta
      </button>
      <div class="countdown" id="countdown" aria-hidden="true"></div>
    </div>

    <!-- Carta -->
    <div
      class="card"
      id="card"
      role="dialog"
      aria-modal="true"
      aria-labelledby="card-title"
      tabindex="-1"
    >
      <div class="intro" id="card-title">Merry Christmas üéÑ</div>
      <div id="text" aria-live="polite"></div>
      <div class="firma" id="firma">Con cari√±o üíñ</div>
      <div class="versiculo" id="versiculo" aria-live="polite"></div>
    </div>

    <script>
      let esMovil = window.innerWidth < 768;

      // Actualiza si cambia el tama√±o (por ejemplo rotaci√≥n)
      window.addEventListener("resize", () => {
        esMovil = window.innerWidth < 768;
      });

      const reduceMotion = window.matchMedia &&
        window.matchMedia("(prefers-reduced-motion: reduce)").matches;

      const nombreAmiga = "Ferrr";
      const mensaje = `Querida ${nombreAmiga},

Que esta Navidad est√© llena de amor,
paz y momentos hermosos.
Gracias por tu amistad
y por ser tan especial.
God bless you a lot üéÑ‚ú®`;

      const versiculoTexto = `‚ÄúPorque un ni√±o nos ha nacido,
un hijo nos ha sido dado.‚Äù
Isa√≠as 9:6`;

      const text = document.getElementById("text");
      const firma = document.getElementById("firma");
      const versiculo = document.getElementById("versiculo");
      const card = document.getElementById("card");
      const start = document.getElementById("start");
      const countdownEl = document.getElementById("countdown");
      const bell = document.getElementById("bell");
      const music = document.getElementById("music");
      const openBtn = document.getElementById("openBtn");

      let i = 0;
      let j = 0;

      function escribir() {
        if (i < mensaje.length) {
          // usar textContent para evitar reflows/HTML injection
          text.textContent += mensaje.charAt(i++);
          setTimeout(escribir, esMovil ? 18 : 10);
        } else {
          firma.classList.add("show");
          setTimeout(escribirVersiculo, 1200);
        }
      }

      function escribirVersiculo() {
        if (j < versiculoTexto.length) {
          versiculo.textContent += versiculoTexto.charAt(j++);
          setTimeout(escribirVersiculo, esMovil ? 20 : 12);
        }
      }

      function iniciarExperiencia() {
        // reproducir campana (manejar la promesa)
        if (bell) {
          bell.currentTime = 0;
          bell.play().catch((e) => {
            // fall√≥ por pol√≠ticas de autoplay ‚Äî no bloquear la experiencia
            console.warn("Reproducci√≥n de campana bloqueada:", e);
          });
        }

        // vibraci√≥n en m√≥viles si disponible
        if (navigator.vibrate && esMovil) {
          navigator.vibrate(200);
        }

        // confetti desactivado si usuario prefiere menos movimiento
        if (!reduceMotion) {
          lanzarConfeti();
        }

        // contador 3..2..1
        let contador = 3;
        countdownEl.style.display = "block";
        countdownEl.setAttribute("aria-hidden", "false");
        countdownEl.textContent = contador;
        const interval = setInterval(() => {
          contador -= 1;
          if (contador > 0) {
            countdownEl.textContent = contador;
          } else {
            clearInterval(interval);
            countdownEl.style.display = "none";
            countdownEl.setAttribute("aria-hidden", "true");
            mostrarCarta();
            // reproducir m√∫sica unos instantes despu√©s (manejar promesa)
            setTimeout(() => {
              if (music) {
                music.volume = 0.9;
                music.play().catch((e) => {
                  console.warn("Reproducci√≥n de m√∫sica bloqueada:", e);
                });
              }
            }, 400);
          }
        }, 700);
      }

      function mostrarCarta() {
        start.style.opacity = 0;
        start.setAttribute("aria-hidden", "true");

        setTimeout(() => {
          start.style.display = "none";
          document.getElementById("card").style.display = "block";
          // enfocar la carta para navegaci√≥n por teclado / lectores de pantalla
          card.focus();
          escribir();
          // crear nieve peri√≥dica si no pide reducir movimiento
          if (!reduceMotion) {
            setInterval(crearNieve, esMovil ? 800 : 350);
          }
        }, 500);
      }

      function lanzarConfeti() {
        const colores = ["#e63946", "#2a9d8f", "#ffffff"];
        const cantidad = esMovil ? 20 : 40;

        for (let k = 0; k < cantidad; k++) {
          const confetti = document.createElement("div");
          confetti.className = "confetti";
          confetti.style.left = Math.random() * window.innerWidth + "px";
          confetti.style.backgroundColor =
            colores[Math.floor(Math.random() * colores.length)];
          // duraci√≥n aleatoria (m√°s suave si reduce velocidad en m√≥viles)
          confetti.style.animationDuration =
            Math.random() * 1 + (esMovil ? 1.8 : 1.2) + "s";
          document.body.appendChild(confetti);
          setTimeout(() => confetti.remove(), 3500);
        }
      }

      const emojis = ["üéÑ", "‚ùÑÔ∏è", "‚≠ê", "üéÅ"];

      function crearNieve() {
        const snow = document.createElement("div");
        snow.className = "snow";
        snow.innerText = emojis[Math.floor(Math.random() * emojis.length)];
        snow.style.left = Math.random() * window.innerWidth + "px";
        snow.style.animationDuration = Math.random() * 3 + 4 + "s";
        document.body.appendChild(snow);
        setTimeout(() => snow.remove(), 7000);
      }

      // manejar click del bot√≥n (y teclado Enter/Space ya que es <button>)
      openBtn.addEventListener("click", iniciarExperiencia);

      // si prefieres puedes exponer una funci√≥n global:
      window.iniciarExperiencia = iniciarExperiencia;
    </script>
  </body>
</html>
