<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Carta Navide√±a üéÑ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <style>
      * {
        box-sizing: border-box;
      }

      /* ====== FONDO NAVIDE√ëO (solo CSS) - TONOS C√ÅLIDOS ======
         - degradados c√°lidos (rojo borgo√±a -> verde oscuro)
         - luces tipo "bokeh" en rojo/dorado/verde
         - destellos dorados sutiles animados (respeta prefers-reduced-motion)
      */
      html,
      body {
        height: 100%;
      }

      body {
        margin: 0;
        height: 100vh;
        font-family: Georgia, serif;
        /* base c√°lida con degradado vertical */
        background-color: #2b0606;
        background-image:
          radial-gradient(circle at 12% 12%, rgba(255,230,180,0.06) 0%, rgba(255,230,180,0) 10%),
          radial-gradient(circle at 88% 20%, rgba(255,200,80,0.04) 0%, rgba(255,200,80,0) 12%),
          linear-gradient(180deg, #4b0f0f 0%, #2a1f10 45%, #081b0f 100%);
        background-repeat: no-repeat;
        background-size: cover;
        overflow: hidden;
        display: flex;
        justify-content: center;
        align-items: center;
        color: #fff8ee;
      }

      /* Luces tipo "bokeh" suaves (delante del fondo, detr√°s del contenido) */
      body::before {
        content: "";
        position: fixed;
        inset: 0;
        pointer-events: none;
        z-index: -2;
        background-image:
          radial-gradient(circle at 12% 24%, rgba(226,103,110,0.12) 0 8%, transparent 20%),
          radial-gradient(circle at 30% 40%, rgba(241,199,88,0.10) 0 7%, transparent 16%),
          radial-gradient(circle at 70% 30%, rgba(81,209,140,0.07) 0 6%, transparent 14%),
          radial-gradient(circle at 50% 80%, rgba(255,215,130,0.06) 0 10%, transparent 22%);
        mix-blend-mode: screen;
        filter: blur(10px) saturate(120%);
      }

      /* Estrellas / destellos sutiles (puntos dorados peque√±os) */
      body::after {
        content: "";
        position: fixed;
        inset: 0;
        pointer-events: none;
        z-index: -1;
        background-image:
          radial-gradient(circle at 6% 8%, rgba(255,246,200,0.95) 0.9px, transparent 1px),
          radial-gradient(circle at 22% 22%, rgba(255,235,170,0.85) 0.7px, transparent 1px),
          radial-gradient(circle at 34% 6%, rgba(255,230,150,0.7) 0.9px, transparent 1px),
          radial-gradient(circle at 56% 18%, rgba(255,215,130,0.6) 0.6px, transparent 1px),
          radial-gradient(circle at 72% 38%, rgba(255,246,200,0.9) 0.8px, transparent 1px),
          radial-gradient(circle at 86% 10%, rgba(255,235,170,0.75) 0.7px, transparent 1px),
          radial-gradient(circle at 61% 5%, rgba(255,220,120,0.65) 0.8px, transparent 1px);
        background-size: 100% 100%;
        opacity: 0.95;
        animation: twinkle 5s linear infinite;
        mix-blend-mode: screen;
        filter: blur(0.5px);
      }

      @keyframes twinkle {
        0% {
          opacity: 0.85;
        }
        50% {
          opacity: 1;
        }
        100% {
          opacity: 0.85;
        }
      }

      /* ====== PANTALLA INICIAL ====== */
      .start {
        position: absolute;
        inset: 0;
        background: rgba(0, 0, 0, 0.65);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
        z-index: 10;
        padding: 20px;
        transition: opacity 1s ease;
      }

      .start h1 {
        font-size: 1.9rem;
        margin-bottom: 25px;
        animation: pulse 1.8s infinite;
        color: #fff6ee;
        text-shadow: 0 2px 8px rgba(0,0,0,0.6);
      }

      @keyframes pulse {
        50% {
          transform: scale(1.05);
        }
      }

      .open-btn {
        padding: 15px 28px;
        font-size: 1.1rem;
        border-radius: 35px;
        border: none;
        background: linear-gradient(135deg, #c72b2b, #b49a3a);
        color: white;
        box-shadow: 0 6px 18px rgba(183, 93, 61, 0.25), 0 0 10px rgba(255, 215, 120, 0.08);
        cursor: pointer;
      }

      .open-btn:focus {
        outline: 3px solid rgba(255, 220, 120, 0.28);
        outline-offset: 4px;
      }

      .countdown {
        margin-top: 25px;
        font-size: 2.5rem;
        display: none;
      }

      /* ====== CARTA ====== */
      .card {
        display: none;
        background: linear-gradient(180deg, rgba(0,0,0,0.55), rgba(10,6,0,0.45));
        width: 92%;
        max-width: 420px;
        padding: 26px;
        border-radius: 20px;
        text-align: center;
        box-shadow: 0 10px 30px rgba(0,0,0,0.6), 0 0 18px rgba(255, 200, 80, 0.06) inset;
        border: 1px solid rgba(255,215,120,0.06);
      }

      .intro {
        font-size: 1.9rem;
        font-weight: bold;
        letter-spacing: 1px;
        margin-bottom: 10px;
        color: #ffefd5;
        text-shadow: 0 2px 8px rgba(0,0,0,0.6);
      }

      #text {
        font-size: 1.05rem;
        line-height: 1.75;
        white-space: pre-line;
        color: #fff9f2;
      }

      .firma {
        opacity: 0;
        margin-top: 18px;
        color: #ffdca8;
        transition: opacity 1.8s ease;
      }

      .firma.show {
        opacity: 1;
      }

      .versiculo {
        margin-top: 18px;
        font-size: 0.95rem;
        font-style: italic;
        line-height: 1.6;
        min-height: 55px;
        color: #ffefd5;
      }

      /* ====== NIEVE ====== */
      .snow {
        position: absolute;
        top: -10px;
        font-size: 20px;
        animation: fall linear forwards;
        pointer-events: none;
        filter: drop-shadow(0 2px 2px rgba(0,0,0,0.4));
      }

      @keyframes fall {
        to {
          transform: translateY(110vh);
        }
      }

      /* ====== CONFETI ====== */
      .confetti {
        position: absolute;
        width: 6px;
        height: 12px;
        top: -10px;
        animation: confetti-fall linear forwards;
        pointer-events: none;
        border-radius: 2px;
      }

      @keyframes confetti-fall {
        to {
          transform: translateY(110vh) rotate(540deg);
          opacity: 0;
        }
      }

      /* ====== MEJORAS PC ====== */
      @media (min-width: 768px) {
        .start h1 {
          font-size: 2.2rem;
        }

        .card {
          animation: glow 2.5s infinite alternate;
        }

        @keyframes glow {
          from {
            box-shadow: 0 0 12px rgba(255,180,110,0.12);
          }
          to {
            box-shadow: 0 0 36px rgba(180,120,40,0.18);
          }
        }
      }

      /* Respeta usuarios que prefieren menos movimiento */
      @media (prefers-reduced-motion: reduce) {
        .start h1,
        .card {
          animation: none !important;
        }
        .snow,
        .confetti,
        body::after,
        body::before {
          display: none !important;
          animation: none !important;
        }
      }
    </style>
  </head>

  <body>
    <!-- Audios -->
    <audio id="bell" preload="auto" playsinline>
      <source src="./sinos-de-natal-440257.mp3" />
    </audio>

    <audio id="music" loop preload="auto" playsinline>
      <source src="./we-wish-you-a-merry-christmas-444573.mp3" />
    </audio>

    <!-- Inicio -->
    <div class="start" id="start" aria-hidden="false">
      <h1>üéÑ Tengo algo para ti üéÑ</h1>
      <button class="open-btn" id="openBtn" type="button">
        üéÅ Abrir carta
      </button>
      <div class="countdown" id="countdown" aria-hidden="true"></div>
    </div>

    <!-- Carta -->
    <div
      class="card"
      id="card"
      role="dialog"
      aria-modal="true"
      aria-labelledby="card-title"
      tabindex="-1"
    >
      <div class="intro" id="card-title">Merry Christmas üéÑ</div>
      <div id="text" aria-live="polite"></div>
      <div class="firma" id="firma">Con cari√±o üíñ</div>
      <div class="versiculo" id="versiculo" aria-live="polite"></div>
    </div>

    <script>
      let esMovil = window.innerWidth < 768;

      // Actualiza si cambia el tama√±o (por ejemplo rotaci√≥n)
      window.addEventListener("resize", () => {
        esMovil = window.innerWidth < 768;
      });

      const reduceMotion = window.matchMedia &&
        window.matchMedia("(prefers-reduced-motion: reduce)").matches;

      const nombreAmiga = "Ferrr";
      const mensaje = `Querida ${nombreAmiga},

Que esta Navidad est√© llena de amor,
paz y momentos hermosos.
Gracias por tu amistad
y por ser tan especial.
God bless you a lot üéÑ‚ú®`;

      const versiculoTexto = `‚ÄúPorque un ni√±o nos ha nacido,
un hijo nos ha sido dado.‚Äù
Isa√≠as 9:6`;

      const text = document.getElementById("text");
      const firma = document.getElementById("firma");
      const versiculo = document.getElementById("versiculo");
      const card = document.getElementById("card");
      const start = document.getElementById("start");
      const countdownEl = document.getElementById("countdown");
      const bell = document.getElementById("bell");
      const music = document.getElementById("music");
      const openBtn = document.getElementById("openBtn");

      let i = 0;
      let j = 0;

      // Escritura m√°s lenta: aument√© los retrasos para que se vea m√°s pausado.
      function escribir() {
        if (i < mensaje.length) {
          // usar textContent para evitar reflows/HTML injection
          text.textContent += mensaje.charAt(i++);
          // m√°s lento: escritorio ~22ms, m√≥vil ~28ms
          setTimeout(escribir, esMovil ? 35 : 22);
        } else {
          firma.classList.add("show");
          setTimeout(escribirVersiculo, 1400);
        }
      }

      function escribirVersiculo() {
        if (j < versiculoTexto.length) {
          versiculo.textContent += versiculoTexto.charAt(j++);
          // vers√≠culo tambi√©n m√°s pausado: escritorio ~26ms, m√≥vil ~36ms
          setTimeout(escribirVersiculo, esMovil ? 36 : 26);
        }
      }

      function iniciarExperiencia() {
        // reproducir campana (manejar la promesa)
        if (bell) {
          bell.currentTime = 0;
          bell.play().catch((e) => {
            // fall√≥ por pol√≠ticas de autoplay ‚Äî no bloquear la experiencia
            console.warn("Reproducci√≥n de campana bloqueada:", e);
          });
        }

        // vibraci√≥n en m√≥viles si disponible
        if (navigator.vibrate && esMovil) {
          navigator.vibrate(200);
        }

        // confetti desactivado si usuario prefiere menos movimiento
        if (!reduceMotion) {
          lanzarConfeti();
        }

        // contador 3..2..1
        let contador = 3;
        countdownEl.style.display = "block";
        countdownEl.setAttribute("aria-hidden", "false");
        countdownEl.textContent = contador;
        const interval = setInterval(() => {
          contador -= 1;
          if (contador > 0) {
            countdownEl.textContent = contador;
          } else {
            clearInterval(interval);
            countdownEl.style.display = "none";
            countdownEl.setAttribute("aria-hidden", "true");
            mostrarCarta();
            // reproducir m√∫sica unos instantes despu√©s (manejar promesa)
            setTimeout(() => {
              if (music) {
                music.volume = 0.9;
                music.play().catch((e) => {
                  console.warn("Reproducci√≥n de m√∫sica bloqueada:", e);
                });
              }
            }, 400);
          }
        }, 700);
      }

      function mostrarCarta() {
        start.style.opacity = 0;
        start.setAttribute("aria-hidden", "true");

        setTimeout(() => {
          start.style.display = "none";
          document.getElementById("card").style.display = "block";
          // enfocar la carta para navegaci√≥n por teclado / lectores de pantalla
          card.focus();
          escribir();
          // crear nieve peri√≥dica si no pide reducir movimiento
          if (!reduceMotion) {
            setInterval(crearNieve, esMovil ? 800 : 350);
          }
        }, 500);
      }

      function lanzarConfeti() {
        const colores = ["#c72b2b", "#b49a3a", "#2a8a4f", "#fff1c2"];
        const cantidad = esMovil ? 28 : 36;

        for (let k = 0; k < cantidad; k++) {
          const confetti = document.createElement("div");
          confetti.className = "confetti";
          confetti.style.left = Math.random() * window.innerWidth + "px";
          confetti.style.backgroundColor =
            colores[Math.floor(Math.random() * colores.length)];
          // duraci√≥n aleatoria (m√°s suave si reduce velocidad en m√≥viles)
          confetti.style.animationDuration =
            Math.random() * 1 + (esMovil ? 1.8 : 1.2) + "s";
          document.body.appendChild(confetti);
          setTimeout(() => confetti.remove(), 3500);
        }
      }

      const emojis = ["üéÑ", "‚ùÑÔ∏è", "‚≠ê", "üéÅ"];

      function crearNieve() {
        const snow = document.createElement("div");
        snow.className = "snow";
        snow.innerText = emojis[Math.floor(Math.random() * emojis.length)];
        snow.style.left = Math.random() * window.innerWidth + "px";
        snow.style.animationDuration = Math.random() * 3 + 4 + "s";
        document.body.appendChild(snow);
        setTimeout(() => snow.remove(), 7000);
      }

      // manejar click del bot√≥n (y teclado Enter/Space ya que es <button>)
      openBtn.addEventListener("click", iniciarExperiencia);

      // si prefieres puedes exponer una funci√≥n global:
      window.iniciarExperiencia = iniciarExperiencia;
    </script>
  </body>
</html>
